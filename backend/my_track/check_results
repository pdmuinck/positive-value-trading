#!/bin/bash

bets=$(cat bets_placed.csv)

echo win > results.csv

for bet in $bets;do
    sport_radar_id=$(echo "${bet}" |cut -d ',' -f 2)
    results=$(../scrapers/sportradar/match_info $sport_radar_id)
    bet_type=$(echo "${bet}" |cut -d ',' -f 10)
    bet_option=$(echo "${bet}" |cut -d ',' -f 13)
    points=$(echo "${bet}" |cut -d ',' -f 15)
    price=$(echo "${bet}" |cut -d ',' -f 14)
    if [[ "$bet_type" == '"1X2"' ]]
    then
        winner=$(echo $results |cut -d ',' -f 4)
        if [[ $winner == $bet_option ]]
        then
            echo $price >> results.csv
        else 
            echo -1 >> results.csv
        fi
    else
        total_goals=$(echo $results |cut -d ',' -f 3)
        if [[ $(echo "$total_goals > $points" |bc) -ne 0 ]]
        then 
            if [[ "$bet_option" == '"Over"' ]]
            then echo $price >> results.csv
            else 
                echo -1 >> results.csv
            fi
        fi
        if [[ $(echo "$total_goals < $points" |bc) -ne 0 ]]
        then 
            if [[ "$bet_option" == '"Under"' ]]
            then echo $price >> results.csv
            else 
                echo -1 >> results.csv
            fi
        fi
    fi
    
done